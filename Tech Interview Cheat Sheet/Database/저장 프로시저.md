# 저장 프로시저(Stroed Procedure)

**저장 프로시저(Stroed Procedure)** 는 일련의 쿼리를 마치 하나의 **함수** 처럼 실행하기 위한 쿼리의 집합이다.  
데이터베이스에 대한 일련의 작업을 정리한 절차를 관계형 데이터베이스 관리 시스템에 저장한것으로, 영구저장모듈(Persistent Storage Module)이라고도 불린다.

![call_sto](https://user-images.githubusercontent.com/66757141/213897835-18ba67ae-7046-40e7-947e-8b14f2f70ff1.gif)

`Oracle`, `MySQL`, `MSSQL` 등 대부분의 DBMS 에서 저장 프로시저 기능을 제공하고 있다.  
Oracle의 경우 아래와 같이 프로시저를 생성하고 실행할 수 있다.

```sql
CREATE PROCEDURE procedure_name(IN parameter)
  BEGIN
    SQL1;
    SQL2;
  END;
  /

EXECUTE procedure_name(parameter);
CALL procedure_name(parameter);
```

<br/>

## 저장 프로시저 사용시 동작 비교

저장 프로시저를 사용하지 않고 SQL문을 사용하는 경우 아래와 같이 동작한다. _마이크로소프트의 T-SQL 기준_

<img src="https://user-images.githubusercontent.com/66757141/213897841-0ad8716c-fd26-4801-97b6-5cdb486c388c.png" alt="" width="520" />
<img src="https://user-images.githubusercontent.com/66757141/213897844-15646a92-8127-44e4-b817-c5a8de46e432.png" alt="" width="380" />
<img src="https://user-images.githubusercontent.com/66757141/213897845-5dd71aae-8c96-42c0-b5b0-91a9e2c688f6.png" alt="" width="460" />
<img src="https://user-images.githubusercontent.com/66757141/213897849-2290afc1-a0c6-4cd2-bbcb-dae85e23b612.png" alt="" width="460" />
<img src="https://user-images.githubusercontent.com/66757141/213897850-a5fa80bd-6584-4e33-a3f9-dbc5905efe27.png" alt="" width="400" />

<br/>

## 저장 프로시저의 장점

1. SQL Server의 성능을 향상 시킬 수 있다.  
   저장 프로시저를 처음에 실행하면 최적화, 컴파일 단계를 거쳐 그 결과가 캐시(메모리)에 저장되게 되는데, 이 후에 해당 SP를 실행하게 되면 캐시(메모리)에 있는 것을 가져와서 사용하므로 실행속도가 빨라지게 된다.
   그렇기 때문에 일반 쿼리를 반복해서 실행하는 것보다 SP 를 사용하는게 성능적인 측면에서 좋다.

2. 유지보수 및 재활용 측면에서 좋다.  
   C#, Java등으로 만들어진 응용프로그램에서 직접 SQL문을 호출하지 않고 저장 프로시저의 이름을 호출하도록 설정하여 사용하는 경우가 많은데, 이때 개발자는 수정요건이 발생할때 코드 내 SQL문을 건드리는게 아니라 SP 파일만 수정하면 되기 때문에 유지보수 측면에서 유리해진다.
   또한 한번 저장 프로시저를 생성해 놓으면, 언제든 실행이 가능하기 때문에 재활용 측면에서 매우 좋다.

3. 보안을 강화할 수 있다.  
   사용자별로 테이블에 권한을 주는게 아닌 저장 프로시저에만 접근 권한을 주는 방식으로 보안을 강화할 수 있다.  
   실제 테이블에 접근하여 다양한 조작을 하는 것은 위험하기 때문에 실무에서는 실제로 개발자에게는 sp권한만 주는 방식을 많이 사용한다.

4. 네트워크의 부하를 줄일 수 있다.  
   클라이언트에서 서버로 쿼리의 모든 텍스트가 전송될 경우 네트워크에는 큰 부하가 발생하게 된다. 하지만 저장 프로시저를 이용한다면 저장프로시저의 이름, 매개변수 등 몇글자만 전송하면 되기 때문에 부하를 크게 줄일 수 있다.

<br/>

## 저장 프로시저의 단점

1. 호환성  
   구문 규칙이 SQL / PSM 표준과의 호환성이 낮기 때문에 코드 자산으로의 재사용성이 나쁘다.

2. 성능  
   문자 또는 숫자 연산에서 프로그래밍 언어인 C나 Java보다 성능이 느리다.

3. 디버깅  
   에러가 발생했을 때, 어디서 잘못됐는지 디버깅하는 것이 힘들 수 있다.

<br/>

---

## Reference

**저장 프로시저와 일반 SQL의 동작 과정 비교**  
✨https://devkingdom.tistory.com/323

📄https://ko.wikipedia.org/wiki/저장_프로시저  
📄https://siahn95.tistory.com/entry/DBMSSQL-저장-프로시저Stored-Procedure란
